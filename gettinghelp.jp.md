---
title: "困ったときは"
---

<hr />

{% toc %}

## 質問がありますか？

Apache Flink コミュニティは毎日多くのユーザの質問に答えています。回答やアドバイスをアーカイブで検索したり、コミュニティに助けやガイダンスを求めて連絡を取ることができます。

### ユーザメーリングリスト

Flink のユーザーメーリングリストには、多くの Flink ユーザー、コントリビューター、コミッターが登録しています。ユーザーメーリングリストは助けを求めるのにとても良い場所です。

メーリングリストに投稿する前に、メーリングリストのアーカイブから自分に関連した問題を議論しているメールのスレッドを以下のサイトで検索することができます。

- [Apache Pony Mail Archive](https://lists.apache.org/list.html?user@flink.apache.org)
- [Nabble Archive](http://apache-flink-user-mailing-list-archive.2336050.n4.nabble.com/)

メーリングリストに投稿したい場合は、以下のようにしてください。

1. `user-subscribe@flink.apache.org` にメールを送ってメーリングリストを購読してください。
2. 確認メールに返信して購読を確認してください。
3. `user@flink.apache.org` にメールを送ってください。

購読されていない方には、メールの返信が届きませんのでご注意ください。

### Stack Overflow

Flink コミュニティの多くのメンバーが [Stack Overflow](https://stackoverflow.com) で活動しています。質問と回答を検索したり、[\[apache-flink\]]](https://stackoverflow.com/questions/tagged/apache-flink)タグを使って質問を投稿したりすることができます。

## バグを見つけましたか？

バグが原因と思われる予期せぬ動作を観察した場合は、報告されたバグを検索したり、[Flink's JIRA] (https://issues.apache.org/jira/issues/?jql=project %3D FLINK) にバグレポートを提出したりすることができます。

予期せぬ動作がバグで起きたのかどうかわからない場合は、[ユーザーメーリングリスト](#user-mailing-list)に質問を投稿してください。

## エラーメッセージが出ましたか？

エラーメッセージの原因を特定するのは難しいことです。以下では、最も一般的なエラーメッセージをリストアップし、それらを処理する方法を説明します。

### NotSerializableExceptionが発生してしまいました。

FlinkはJavaのシリアライゼーションを使用して、アプリケーション・ロジック（あなたが実装した関数や操作、プログラム構成など)のコピーを並列ワーカープロセスに配布します。
そのため、API に渡す関数は
[java.io.Serializable](http://docs.oracle.com/javase/8/docs/api/java/io/Serializable.html)に定義されているように、
すべてシリアライズ可能でなければなりません。

関数が匿名のインナークラスの場合は、次のように考えてみてください。

  - 関数を独立したクラスにするか、静的な内部クラスにします。
  - Java 8 のラムダ関数を使用します。

あなたの関数がすでに静的クラスである場合、クラスのインスタンスを作成する際に割り当てるフィールドを確認してください。フィールドのいずれかがシリアライズ不可能な型を保持している可能性が高いです。

  - Javaでは、`RichFunction`を用いて問題のあるフィールドを`open()`メソッドで初期化する。
  - Scalaでは、単純に "lazy val "を使って、分散実行が行われるまで初期化を延期することがよくあります。これは、パフォーマンスを犠牲にすることになるかもしれません。Scalaでは当然ながら `RichFunction` を使うこともできます。

### Scala APIを使用すると、暗黙の値とエビデンスパラメータに関するエラーが発生します。

このエラーは、型情報の暗黙の値を提供できなかったことを意味します。
コード中に `import org.apache.flink.streaming.api.scala._` (DataStream API) または `import org.apache.flink.api.scala._` (DataSet API) ステートメントがあることを確認してください。

一般的なパラメータを取る関数やクラスの内部でFlink操作を使用する場合は、そのパラメータに対して型情報が利用可能でなければなりません。
これは、コンテキストバウンドを使用することで実現できます。

~~~scala
def myFunction[T: TypeInformation](input: DataSet[T]): DataSet[Seq[T]] = {
  input.reduceGroup( i => i.toSeq )
}
~~~

Flinkがどのように型を扱うかについては、[型の抽出とシリアライズ]({{ site.docs-snapshot }}/dev/types_serialization.html)を参照してください。

### ClassCastExceptionが出てきました。X にキャストできません。

`com.foo.X` が `com.foo.X` にキャストできない (あるいは `com.foo.X` に代入できない) という形式の例外が発生した場合は、クラス `com.foo.X` の複数のバージョンが異なるクラスローダによってロードされ、そのクラスの型が互いに代入されようとしていることを意味します。

その理由としては以下のようなことが考えられます。

  - `child-first` クラスローディングによるクラスの重複。これは、ユーザが Flink が使用するのと同じ依存関係の異なるバージョンを使用できるようにするための仕組みです。
    しかし、これらのクラスの異なるコピーが Flink のコアとユーザアプリケーションのコードの間を移動すると、そのような例外が発生する可能性があります。
    これが原因であることを確認するには、設定で `classloader.resolve-order: parent-first` を設定してみてください。これでエラーが消えるようであれば、
    メーリングリストに書き込みをして、バグかもしれないかどうか確認してください。

  - 例えば、GuavaのインターナやAvroのSchemaキャッシュのようなユーティリティによる、異なる実行試行からのクラスのキャッシュ。
    インターナを使わないようにしたり、インターナ/キャッシュのスコープを小さくして、新しいタスクの実行が開始されるたびに新しいキャッシュが作成されるようにしてください。

### AbstractMethodErrorやNoSuchFieldErrorが出てしまいました。

このようなエラーは、典型的には依存関係のバージョンが混ざっていることを示しています。つまり、コードがコンパイルされたバージョンとは異なるバージョンの依存関係(ライブラリ)が実行中に読み込まれていることを意味します。

Flink 1.4.0 以降では、アプリケーションの JAR ファイル内の依存関係は、Flink のコアで使用される依存関係や、クラスパス内の他の依存関係 (例えば Hadoop からの依存関係) とは異なるバージョンになる可能性があります。そのため、`child-first` クラスローディングを有効にする必要があります。これはデフォルトの設定です。

Flink 1.4+でこれらの問題が発生した場合、以下のいずれかが当てはまる可能性があります。

  - アプリケーションコード内で依存関係のバージョンが競合しています。すべての依存関係のバージョンが一貫していることを確認してください。
  - あなたは、`child-first` クラスローディングで Flink がサポートできないライブラリと競合しています。現在のところ、これらはScalaの標準ライブラリクラス、Flink独自のクラス、ロギングAPI、Hadoopコアクラスです。


### 私のデータストリームアプリケーションは、イベントが入力されているにもかかわらず、出力を生成しません。

DataStreamアプリケーションが *イベント時間* を使用している場合、ウォーターマークが更新されていることを確認してください。ウォーターマークが生成されない場合、イベントタイムウィンドウは決してトリガされず、アプリケーションは結果を生成しないかもしれません。

ウォーターマークが進んでいるかどうかは、FlinkのWeb UI（ウォーターマークセクション）で確認することができます。

### 「ネットワークバッファの数が不足しています」という例外が報告されています。

Flinkを非常に高い並列性で実行している場合、ネットワークバッファの数を増やす必要があるかもしれません。

デフォルトでは、FlinkはネットワークバッファのためにJVMヒープサイズの10%を取ります。
これらの値は `taskmanager.network.memory.fraction`, `taskmanager.network.memory.min`, `taskmanager.network.memory.max` で調整可能です。

詳細は、[設定リファレンス]({{ site.docs-snapshot }}/ops/config.html#configuring-the-network-buffers)を参照してください。

### HDFS/Hadoopのコードから様々な例外が発生してジョブが失敗しました。どうすればいいですか？

最も一般的な原因は、FlinkのクラスパスにあるHadoopのバージョンと、接続したいクラスタのHadoopのバージョン（HDFS / YARN）が異なることです。

これを修正する最も簡単な方法は、HadoopフリーのFlinkバージョンを選択し、クラスタからHadoopパスとクラスパスをエクスポートするだけです。

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Apache Flink: Stateful Functions 3.1.0 Release Announcement</title>
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

    <!-- Bootstrap -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/flink.css">
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Blog RSS feed -->
    <link href="/blog/feed.xml" rel="alternate" type="application/rss+xml" title="Apache Flink Blog: RSS feed" />

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <!-- We need to load Jquery in the header for custom google analytics event tracking-->
    <script src="/js/jquery.min.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Matomo -->
    <script>
      var _paq = window._paq = window._paq || [];
      /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
      /* We explicitly disable cookie tracking to avoid privacy issues */
      _paq.push(['disableCookies']);
      /* Measure a visit to flink.apache.org and nightlies.apache.org/flink as the same visit */
      _paq.push(["setDomains", ["*.flink.apache.org","*.nightlies.apache.org/flink"]]);
      _paq.push(['trackPageView']);
      _paq.push(['enableLinkTracking']);
      (function() {
        var u="//matomo.privacy.apache.org/";
        _paq.push(['setTrackerUrl', u+'matomo.php']);
        _paq.push(['setSiteId', '1']);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
        g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
      })();
    </script>
    <!-- End Matomo Code -->
  </head>
  <body>  
    

    <!-- Main content. -->
    <div class="container">
    <div class="row">

      
     <div id="sidebar" class="col-sm-3">
        

<!-- Top navbar. -->
    <nav class="navbar navbar-default">
        <!-- The logo. -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <div class="navbar-logo">
            <a href="/">
              <img alt="Apache Flink" src="/img/flink-header-logo.svg" width="147px" height="73px">
            </a>
          </div>
        </div><!-- /.navbar-header -->

        <!-- The navigation links. -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          <ul class="nav navbar-nav navbar-main">

            <!-- First menu section explains visitors what Flink is -->

            <!-- What is Stream Processing? -->
            <!--
            <li><a href="/streamprocessing1.html">What is Stream Processing?</a></li>
            -->

            <!-- What is Flink? -->
            <li><a href="/flink-architecture.html">What is Apache Flink?</a></li>

            

            <!-- Stateful Functions? -->

            <li><a href="https://nightlies.apache.org/flink/flink-statefun-docs-stable/">What is Stateful Functions?</a></li>

            <!-- Flink ML? -->

            <li><a href="https://nightlies.apache.org/flink/flink-ml-docs-stable/">What is Flink ML?</a></li>

            <!-- Flink Kubernetes Operator? -->

            <li><a href="https://nightlies.apache.org/flink/flink-kubernetes-operator-docs-stable/">What is the Flink Kubernetes Operator?</a></li>

            <!-- Flink Table Store? -->

            <li><a href="https://nightlies.apache.org/flink/flink-table-store-docs-stable/">What is Flink Table Store?</a></li>

            <!-- Use cases -->
            <li><a href="/usecases.html">Use Cases</a></li>

            <!-- Powered by -->
            <li><a href="/poweredby.html">Powered By</a></li>


            &nbsp;
            <!-- Second menu section aims to support Flink users -->

            <!-- Downloads -->
            <li><a href="/downloads.html">Downloads</a></li>

            <!-- Getting Started -->
            <li class="dropdown">
              <a class="dropdown-toggle" data-toggle="dropdown" href="#">Getting Started<span class="caret"></span></a>
              <ul class="dropdown-menu">
                <li><a href="https://nightlies.apache.org/flink/flink-docs-release-1.15//docs/try-flink/local_installation/" target="_blank">With Flink <small><span class="glyphicon glyphicon-new-window"></span></small></a></li>
                <li><a href="https://nightlies.apache.org/flink/flink-statefun-docs-release-3.2/getting-started/project-setup.html" target="_blank">With Flink Stateful Functions <small><span class="glyphicon glyphicon-new-window"></span></small></a></li>
                <li><a href="https://nightlies.apache.org/flink/flink-ml-docs-release-2.1/try-flink-ml/quick-start.html" target="_blank">With Flink ML <small><span class="glyphicon glyphicon-new-window"></span></small></a></li>
                <li><a href="https://nightlies.apache.org/flink/flink-kubernetes-operator-docs-release-1.2/try-flink-kubernetes-operator/quick-start.html" target="_blank">With Flink Kubernetes Operator <small><span class="glyphicon glyphicon-new-window"></span></small></a></li>
                <li><a href="https://nightlies.apache.org/flink/flink-table-store-docs-release-0.2/try-table-store/quick-start.html" target="_blank">With Flink Table Store <small><span class="glyphicon glyphicon-new-window"></span></small></a></li>
                <li><a href="/training.html">Training Course</a></li>
              </ul>
            </li>

            <!-- Documentation -->
            <li class="dropdown">
              <a class="dropdown-toggle" data-toggle="dropdown" href="#">Documentation<span class="caret"></span></a>
              <ul class="dropdown-menu">
                <li><a href="https://nightlies.apache.org/flink/flink-docs-release-1.15" target="_blank">Flink 1.16 (Latest stable release) <small><span class="glyphicon glyphicon-new-window"></span></small></a></li>
                <li><a href="https://nightlies.apache.org/flink/flink-docs-master" target="_blank">Flink Master (Latest Snapshot) <small><span class="glyphicon glyphicon-new-window"></span></small></a></li>
                <li><a href="https://nightlies.apache.org/flink/flink-statefun-docs-release-3.2" target="_blank">Flink Stateful Functions 3.2 (Latest stable release) <small><span class="glyphicon glyphicon-new-window"></span></small></a></li>
                <li><a href="https://nightlies.apache.org/flink/flink-statefun-docs-master" target="_blank">Flink Stateful Functions Master (Latest Snapshot) <small><span class="glyphicon glyphicon-new-window"></span></small></a></li>
                <li><a href="https://nightlies.apache.org/flink/flink-ml-docs-release-2.1" target="_blank">Flink ML 2.1 (Latest stable release) <small><span class="glyphicon glyphicon-new-window"></span></small></a></li>
                <li><a href="https://nightlies.apache.org/flink/flink-ml-docs-master" target="_blank">Flink ML Master (Latest Snapshot) <small><span class="glyphicon glyphicon-new-window"></span></small></a></li>
                <li><a href="https://nightlies.apache.org/flink/flink-kubernetes-operator-docs-release-1.2" target="_blank">Flink Kubernetes Operator 1.2 (Latest stable release) <small><span class="glyphicon glyphicon-new-window"></span></small></a></li>
                <li><a href="https://nightlies.apache.org/flink/flink-kubernetes-operator-docs-main" target="_blank">Flink Kubernetes Operator Main (Latest Snapshot) <small><span class="glyphicon glyphicon-new-window"></span></small></a></li>
                <li><a href="https://nightlies.apache.org/flink/flink-table-store-docs-release-0.2" target="_blank">Flink Table Store 0.2 (Latest stable release) <small><span class="glyphicon glyphicon-new-window"></span></small></a></li>
                <li><a href="https://nightlies.apache.org/flink/flink-table-store-docs-master" target="_blank">Flink Table Store Master (Latest Snapshot) <small><span class="glyphicon glyphicon-new-window"></span></small></a></li>
              </ul>
            </li>

            <!-- getting help -->
            <li><a href="/gettinghelp.html">Getting Help</a></li>

            <!-- Blog -->
            <li class="active"><a href="/blog/"><b>Flink Blog</b></a></li>


            <!-- Flink-packages -->
            <li>
              <a href="https://flink-packages.org" target="_blank">flink-packages.org <small><span class="glyphicon glyphicon-new-window"></span></small></a>
            </li>
            &nbsp;

            <!-- Third menu section aim to support community and contributors -->

            <!-- Community -->
            <li><a href="/community.html">Community &amp; Project Info</a></li>

            <!-- Roadmap -->
            <li><a href="/roadmap.html">Roadmap</a></li>

            <!-- Contribute -->
            <li><a href="/contributing/how-to-contribute.html">How to Contribute</a></li>
            

            <!-- GitHub -->
            <li>
              <a href="https://github.com/apache/flink" target="_blank">Flink on GitHub <small><span class="glyphicon glyphicon-new-window"></span></small></a>
            </li>

            &nbsp;

            <!-- Language Switcher -->
            <li>
              
                
                  <!-- link to the Chinese home page when current is blog page -->
                  <a href="/zh">中文版</a>
                
              
            </li>

          </ul>

          <style>
            .smalllinks:link {
              display: inline-block !important; background: none; padding-top: 0px; padding-bottom: 0px; padding-right: 0px; min-width: 75px;
            }
          </style>

          <ul class="nav navbar-nav navbar-bottom">
          <hr />

            <!-- Twitter -->
            <li><a href="https://twitter.com/apacheflink" target="_blank">@ApacheFlink <small><span class="glyphicon glyphicon-new-window"></span></small></a></li>

            <!-- Visualizer -->
            <li class=" hidden-md hidden-sm"><a href="/visualizer/" target="_blank">Plan Visualizer <small><span class="glyphicon glyphicon-new-window"></span></small></a></li>

            <li >
                  <a href="/security.html">Flink Security</a>
            </li>

          <hr />

            <li><a href="https://apache.org" target="_blank">Apache Software Foundation <small><span class="glyphicon glyphicon-new-window"></span></small></a></li>

            <li>

              <a class="smalllinks" href="https://www.apache.org/licenses/" target="_blank">License</a> <small><span class="glyphicon glyphicon-new-window"></span></small>

              <a class="smalllinks" href="https://www.apache.org/security/" target="_blank">Security</a> <small><span class="glyphicon glyphicon-new-window"></span></small>

              <a class="smalllinks" href="https://www.apache.org/foundation/sponsorship.html" target="_blank">Donate</a> <small><span class="glyphicon glyphicon-new-window"></span></small>

              <a class="smalllinks" href="https://www.apache.org/foundation/thanks.html" target="_blank">Thanks</a> <small><span class="glyphicon glyphicon-new-window"></span></small>
            </li>

          </ul>
        </div><!-- /.navbar-collapse -->
    </nav>

      </div>
      <div class="col-sm-9">
      <div class="row-fluid">
  <div class="col-sm-12">
    <div class="row">
      <h1>Stateful Functions 3.1.0 Release Announcement</h1>
      <p><i>The Apache Flink community is happy to announce the release of Stateful Functions (StateFun) 3.1.0.</i></p>

      <article>
        <p>31 Aug 2021 Seth Wiesman (<a href="https://twitter.com/sjwiesman">@sjwiesman</a>), Igal Shilman (<a href="https://twitter.com/IgalShilman">@IgalShilman</a>), &amp; Tzu-Li (Gordon) Tai (<a href="https://twitter.com/tzulitai">@tzulitai</a>)</p>

<p>Stateful Functions is a cross-platform stack for building Stateful Serverless applications, making it radically simpler to develop scalable, consistent, and elastic distributed applications.
This new release brings various improvements to the StateFun runtime, a leaner way to specify StateFun module components, and a brand new GoLang SDK!</p>

<p>The binary distribution and source artifacts are now available on the updated <a href="https://flink.apache.org/downloads.html">Downloads</a>
page of the Flink website, and the most recent Java SDK, Python SDK, and GoLang SDK distributions are available on <a href="https://search.maven.org/artifact/org.apache.flink/statefun-sdk-java/3.1.0/jar">Maven</a>, <a href="https://pypi.org/project/apache-flink-statefun/">PyPI</a>, and <a href="https://github.com/apache/flink-statefun/tree/statefun-sdk-go/v3.1.0">Github</a> repecitvely.
You can also find official StateFun Docker images of the new version on <a href="https://hub.docker.com/r/apache/flink-statefun">Dockerhub</a>.</p>

<p>For more details, check the complete <a href="https://issues.apache.org/jira/secure/ReleaseNote.jspa?version=12350038&amp;projectId=12315522">release changelog</a> 
and the <a href="https://nightlies.apache.org/flink/flink-statefun-docs-release-3.0/">updated documentation</a>.
We encourage you to download the release and share your feedback with the community through the <a href="https://flink.apache.org/community.html#mailing-lists">Flink mailing lists</a>
or <a href="https://issues.apache.org/jira/browse/">JIRA</a>!</p>

<div class="page-toc">
<ul id="markdown-toc">
  <li><a href="#new-features" id="markdown-toc-new-features">New Features</a>    <ul>
      <li><a href="#delayed-message-cancellation" id="markdown-toc-delayed-message-cancellation">Delayed Message Cancellation</a></li>
      <li><a href="#new-way-to-specify-components" id="markdown-toc-new-way-to-specify-components">New way to specify components</a></li>
      <li><a href="#pluggable-transport-for-remote-function-invocations" id="markdown-toc-pluggable-transport-for-remote-function-invocations">Pluggable transport for remote function invocations</a></li>
      <li><a href="#asynchronous-non-blocking-remote-function-invocation-beta" id="markdown-toc-asynchronous-non-blocking-remote-function-invocation-beta">Asynchronous, non blocking remote function invocation (beta)</a></li>
      <li><a href="#a-brand-new-golang-sdk" id="markdown-toc-a-brand-new-golang-sdk">A brand new GoLang SDK</a></li>
    </ul>
  </li>
  <li><a href="#release-notes" id="markdown-toc-release-notes">Release Notes</a></li>
  <li><a href="#release-notes-1" id="markdown-toc-release-notes-1">Release Notes</a></li>
  <li><a href="#list-of-contributors" id="markdown-toc-list-of-contributors">List of Contributors</a></li>
</ul>

</div>

<h2 id="new-features">New Features</h2>

<h3 id="delayed-message-cancellation">Delayed Message Cancellation</h3>

<p>Stateful Functions communicate by sending messages, but sometimes it is helpful that a function will send a message for itself.
For example, you may want to set a time limit on a customer onboarding flow to complete.
This can easily be implmented by sending a message with a delay.
But up until now, there was no way to indicate to the StateFun runtime that a particular delayed message is not necessary anymore (a customer had completed their onboarding flow).
With StateFun 3.1, it is now possible to cancel a delayed message.</p>

<div class="highlight"><pre><code class="language-python"><span class="o">...</span>
<span class="n">context</span><span class="o">.</span><span class="n">send_after</span><span class="p">(</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
                  <span class="n">message_builder</span><span class="p">(</span><span class="n">target_typename</span><span class="o">=</span><span class="s">&quot;fns/onboarding&quot;</span><span class="p">,</span>
                                  <span class="n">target_id</span><span class="o">=</span><span class="s">&quot;user-1234&quot;</span><span class="p">,</span>
                                  <span class="n">str_value</span><span class="o">=</span><span class="s">&quot;send a reminder email&quot;</span><span class="p">),</span>
                  <span class="n">cancellation_token</span><span class="o">=</span><span class="s">&quot;flow-1234&quot;</span><span class="p">)</span>
<span class="o">...</span></code></pre></div>

<p>To cancel the message at a later time, simply call</p>

<div class="highlight"><pre><code class="language-python"><span class="n">context</span><span class="o">.</span><span class="n">cancel_delayed_message</span><span class="p">(</span><span class="s">&quot;flow-1234&quot;</span><span class="p">)</span></code></pre></div>

<p>Please note that a message cancellation occurs on a best-effort basis, as the message might have already been delivered or enqueued for immediate delivery on a remote worker’s mailbox.</p>

<h3 id="new-way-to-specify-components">New way to specify components</h3>

<p>StateFun applications consist of multiple configuration components, including remote function endpoints, along with ingress and egress definitions, defined in a YAML format. 
We’ve added a new structure that treats each StateFun component as a standalone YAML document in this release.
Thus, a <code>module.yaml</code> file becomes simply a collection of components.</p>

<div class="highlight"><pre><code class="language-yaml"><span class="l-Scalar-Plain">kind</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">io.statefun.endpoints.v2/http</span>
<span class="l-Scalar-Plain">spec</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">functions</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">com.example/*</span>
  <span class="l-Scalar-Plain">urlPathTemplate</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">https://bar.foo.com/{function.name}</span>
<span class="nn">---</span>
<span class="l-Scalar-Plain">kind</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">io.statefun.kafka.v1/ingress</span>
<span class="l-Scalar-Plain">spec</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">id</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">com.example/my-ingress</span>
  <span class="l-Scalar-Plain">address</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">kafka-broker:9092</span>
  <span class="l-Scalar-Plain">consumerGroupId</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">my-consumer-group</span>
  <span class="l-Scalar-Plain">topics</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">topic</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">message-topic</span>
      <span class="l-Scalar-Plain">valueType</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">io.statefun.types/string</span>
      <span class="l-Scalar-Plain">targets</span><span class="p-Indicator">:</span>
        <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">com.example/greeter</span>
<span class="nn">---</span>
<span class="l-Scalar-Plain">kind</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">io.statefun.kafka.v1/egress</span>
<span class="l-Scalar-Plain">spec</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">id</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">com.example/my-egress</span>
  <span class="l-Scalar-Plain">address</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">kafka-broker:9092</span>
  <span class="l-Scalar-Plain">deliverySemantic</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">exactly-once</span>
    <span class="l-Scalar-Plain">transactionTimeout</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">15min</span>
<span class="nn">---</span></code></pre></div>

<p>While this might seem like a minor cosmetic improvement, this change opens the door to more flexible configuration management options in future releases - such as managing each component as a custom K8s resource definition or even behind a REST API. StateFun still supports the legacy module format in version 3.0 for backward compatibility, but users are encouraged to upgrade. 
The community is providing an <a href="https://github.com/sjwiesman/statefun-module-upgrade">automated migration tool</a> to ease the transition.</p>

<h3 id="pluggable-transport-for-remote-function-invocations">Pluggable transport for remote function invocations</h3>
<p>It is possible to plugin a custom mechanism that invokes a remote stateful function starting with this release.
Users who wish to use a customized transport need to register it as an extension and later reference it straight from the endpoint component definition.</p>

<p>For example:</p>

<div class="highlight"><pre><code class="language-yaml"><span class="l-Scalar-Plain">kind</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">io.statefun.endpoints.v2/http</span>
<span class="l-Scalar-Plain">spec</span><span class="p-Indicator">:</span>
 <span class="l-Scalar-Plain">functions</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">com.foo.bar/*</span>
 <span class="l-Scalar-Plain">urlPathTemplate</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">https://{function.name}/</span>
 <span class="l-Scalar-Plain">maxNumBatchRequests</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">10000</span>
 <span class="l-Scalar-Plain">transport</span><span class="p-Indicator">:</span>
   <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">com.foo.bar/pubsub</span>
   <span class="l-Scalar-Plain">some_property1</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">some_value1</span></code></pre></div>

<p>For a complete example of a custom transport you can start exploring <a href="https://github.com/apache/flink-statefun/blob/release-3.1.0/statefun-flink/statefun-flink-core/src/main/java/org/apache/flink/statefun/flink/core/nettyclient/NettyTransportModule.java">here</a>.
Along with a reference usage over <a href="https://github.com/apache/flink-statefun/blob/release-3.1.0/statefun-e2e-tests/statefun-smoke-e2e-java/src/test/resources/remote-module/module.yaml#L21-L22">here</a>.</p>

<h3 id="asynchronous-non-blocking-remote-function-invocation-beta">Asynchronous, non blocking remote function invocation (beta)</h3>

<p>For this release we’ve included a new transport implementation (opt in for this release) that is implemented on top of the asynchronous Netty framework.
This transport enables much higher resource utilization, higher throughput, and lower remote function invocation latency.</p>

<p>To enable this new transport, set the transport type to be <code>io.statefun.transports.v1/async</code>
Like in the following example:</p>

<div class="highlight"><pre><code class="language-yaml"><span class="l-Scalar-Plain">kind</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">io.statefun.endpoints.v2/http</span>
<span class="l-Scalar-Plain">spec</span><span class="p-Indicator">:</span>
 <span class="l-Scalar-Plain">functions</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">fns/*</span>
 <span class="l-Scalar-Plain">urlPathTemplate</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">https://api-gateway.foo.bar/{function.name}</span>
 <span class="l-Scalar-Plain">maxNumBatchRequests</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">10000</span>
 <span class="l-Scalar-Plain">transport</span><span class="p-Indicator">:</span>
   <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">io.statefun.transports.v1/async</span>
   <span class="l-Scalar-Plain">call</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">2m</span>
   <span class="l-Scalar-Plain">connect</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">20s</span></code></pre></div>

<p>Take it for a spin!</p>

<h3 id="a-brand-new-golang-sdk">A brand new GoLang SDK</h3>

<p>Stateful Functions provides a unified model for building stateful applications across various programming languages and deployment environments.
The community is thrilled to release an official GoLang SDK as part of the 3.1.0 release.</p>

<div class="highlight"><pre><code class="language-go"><span class="kn">import</span> <span class="p">(</span>
  <span class="s">&quot;fmt&quot;</span>
  <span class="s">&quot;github.com/apache/flink-statefun/statefun-sdk-go/v3/pkg/statefun&quot;</span>
  <span class="s">&quot;net/http&quot;</span>
<span class="p">)</span>
 
<span class="kd">type</span> <span class="nx">Greeter</span> <span class="kd">struct</span> <span class="p">{</span>
  <span class="nx">SeenCount</span> <span class="nx">statefun</span><span class="p">.</span><span class="nx">ValueSpec</span>
<span class="p">}</span>
 
<span class="kd">func</span> <span class="p">(</span><span class="nx">g</span> <span class="o">*</span><span class="nx">Greeter</span><span class="p">)</span> <span class="nx">Invoke</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">statefun</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">message</span> <span class="nx">statefun</span><span class="p">.</span><span class="nx">Message</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
  <span class="nx">storage</span> <span class="o">:=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">Storage</span><span class="p">()</span>
 
  <span class="c1">// Read the current value of the state</span>
  <span class="c1">// or zero value if no value is set</span>
  <span class="kd">var</span> <span class="nx">count</span> <span class="kt">int32</span>
  <span class="nx">storage</span><span class="p">.</span><span class="nx">Get</span><span class="p">(</span><span class="nx">g</span><span class="p">.</span><span class="nx">SeenCount</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">count</span><span class="p">)</span>
 
  <span class="nx">count</span> <span class="o">+=</span> <span class="mi">1</span>
 
  <span class="c1">// Update the state which will</span>
  <span class="c1">// be made persistent by the runtime</span>
  <span class="nx">storage</span><span class="p">.</span><span class="nx">Set</span><span class="p">(</span><span class="nx">g</span><span class="p">.</span><span class="nx">SeenCount</span><span class="p">,</span> <span class="nx">count</span><span class="p">)</span>
 
  <span class="nx">name</span> <span class="o">:=</span> <span class="nx">message</span><span class="p">.</span><span class="nx">AsString</span><span class="p">()</span>
  <span class="nx">greeting</span> <span class="o">:=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;Hello there %s at the %d-th time!\n&quot;</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">count</span><span class="p">)</span>
 
  <span class="nx">ctx</span><span class="p">.</span><span class="nx">Send</span><span class="p">(</span><span class="nx">statefun</span><span class="p">.</span><span class="nx">MessageBuilder</span><span class="p">{</span>
     <span class="nx">Target</span><span class="p">:</span>    <span class="o">*</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">Caller</span><span class="p">(),</span>
     <span class="nx">Value</span><span class="p">:</span>     <span class="nx">greeting</span><span class="p">,</span>
  <span class="p">})</span>
 
  <span class="k">return</span> <span class="kc">nil</span>
<span class="p">}</span>
 
 
<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">greeter</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">Greeter</span><span class="p">{</span>
     <span class="nx">SeenCount</span><span class="p">:</span> <span class="nx">statefun</span><span class="p">.</span><span class="nx">ValueSpec</span><span class="p">{</span>
        <span class="nx">Name</span><span class="p">:</span>      <span class="s">&quot;seen_count&quot;</span><span class="p">,</span>
        <span class="nx">ValueType</span><span class="p">:</span> <span class="nx">statefun</span><span class="p">.</span><span class="nx">Int32Type</span><span class="p">,</span>
     <span class="p">},</span>
  <span class="p">}</span>
 
  <span class="nx">builder</span> <span class="o">:=</span> <span class="nx">statefun</span><span class="p">.</span><span class="nx">StatefulFunctionsBuilder</span><span class="p">()</span>
  <span class="nx">_</span> <span class="p">=</span> <span class="nx">builder</span><span class="p">.</span><span class="nx">WithSpec</span><span class="p">(</span><span class="nx">statefun</span><span class="p">.</span><span class="nx">StatefulFunctionSpec</span><span class="p">{</span>
     <span class="nx">FunctionType</span><span class="p">:</span> <span class="nx">statefun</span><span class="p">.</span><span class="nx">TypeNameFrom</span><span class="p">(</span><span class="s">&quot;com.example.fns/greeter&quot;</span><span class="p">),</span>
     <span class="nx">States</span><span class="p">:</span>       <span class="p">[]</span><span class="nx">statefun</span><span class="p">.</span><span class="nx">ValueSpec</span><span class="p">{</span><span class="nx">greeter</span><span class="p">.</span><span class="nx">SeenCount</span><span class="p">},</span>
     <span class="nx">Function</span><span class="p">:</span>     <span class="nx">greeter</span><span class="p">,</span>
  <span class="p">})</span>
 
  <span class="nx">http</span><span class="p">.</span><span class="nx">Handle</span><span class="p">(</span><span class="s">&quot;/statefun&quot;</span><span class="p">,</span> <span class="nx">builder</span><span class="p">.</span><span class="nx">AsHandler</span><span class="p">())</span>
  <span class="nx">_</span> <span class="p">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ListenAndServe</span><span class="p">(</span><span class="s">&quot;:8000&quot;</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
<span class="p">}</span></code></pre></div>

<p>As with the Python and Java SDKs, the Go SDK includes:</p>

<ul>
  <li>An address scoped storage acting as a key-value store for a particular address.</li>
  <li>A unified cross-language way to send, receive and store values across languages.</li>
  <li>Dynamic <code>ValueSpec</code> to describe the state name, type, and possibly expiration configuration at runtime.</li>
</ul>

<p>You can get started by adding the SDK to your <code>go.mod</code> file.</p>

<p><code>require github.com/apache/flink-statefun/statefun-sdk-go/v3 v3.1.0</code></p>

<p>For a detailed SDK tutorial, we would like to encourage you to visit:</p>

<ul>
  <li><a href="https://github.com/apache/flink-statefun-playground/tree/release-3.1/go/showcase">GoLang SDK Showcase</a></li>
  <li><a href="https://github.com/apache/flink-statefun-playground/tree/release-3.1/go/greeter">GoLang Greeter</a></li>
  <li><a href="https://nightlies.apache.org/flink/flink-statefun-docs-release-3.1/docs/sdk/golang/">GoLang SDK Documentation</a></li>
</ul>

<h2 id="release-notes">Release Notes</h2>

<h2 id="release-notes-1">Release Notes</h2>

<p>Please review the <a href="https://issues.apache.org/jira/secure/ReleaseNote.jspa?version=12350038&amp;projectId=12315522">release notes</a>
for a detailed list of changes and new features if you plan to upgrade your setup to Stateful Functions 3.1.0.</p>

<h2 id="list-of-contributors">List of Contributors</h2>

<p>Evans Ye, George Birbilis, Igal Shilman, Konstantin Knauf, Seth Wiesman, Siddique Ahmad, Tzu-Li (Gordon) Tai, ariskk, austin ce</p>

<p>If you’d like to get involved, we’re always <a href="https://github.com/apache/flink-statefun#contributing">looking for new contributors</a>.</p>

      </article>
    </div>

    <div class="row">
      <div id="disqus_thread"></div>
      <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'stratosphere-eu'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
             (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
      </script>
    </div>
  </div>
</div>
      </div>
    </div>

    <hr />

    <div class="row">
      <div class="footer text-center col-sm-12">
        <p>Copyright © 2014-2022 <a href="http://apache.org">The Apache Software Foundation</a>. All Rights Reserved.</p>
        <p>Apache Flink, Flink®, Apache®, the squirrel logo, and the Apache feather logo are either registered trademarks or trademarks of The Apache Software Foundation.</p>
        <p><a href="https://privacy.apache.org/policies/privacy-policy-public.html">Privacy Policy</a> &middot; <a href="/blog/feed.xml">RSS feed</a></p>
      </div>
    </div>
    </div><!-- /.container -->

    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="/js/jquery.matchHeight-min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/codetabs.js"></script>
    <script src="/js/stickysidebar.js"></script>
  </body>
</html>

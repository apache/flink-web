---
title: "ユースケース"
---

<hr />

Apache Flink はその豊富な機能セットにより、多くの異なるタイプのアプリケーションを開発・実行するのに最適な選択肢です。Flink の機能には、ストリームおよびバッチ処理のサポート、洗練されたステート管理、イベントタイム処理セマンティクス、ステートの正確な一度きりの一貫性保証などがあります。さらに、Flinkは、YARN、Apache Mesos、Kubernetesなどの様々なリソースプロバイダ上に展開することができるだけでなく、ベアメタルハードウェア上のスタンドアロンクラスタとしても展開することができます。高可用性のために設定されたFlinkは、単一の障害点を持ちません。Flinkは、何千ものコアとテラバイトのアプリケーションステートへの拡張性が実証されており、高いスループットと低レイテンシを実現し、世界で最も要求の厳しいストリーム処理アプリケーションの一部に力を与えています。

以下では、Flinkを利用したアプリケーションの中で最も一般的なタイプを探り、実例を示します。

* <a href="#eventDrivenApps">イベントドリブンアプリケーション</a>
* <a href="#analytics">データ分析アプリケーション</a>
* <a href="#pipelines">データパイプラインアプリケーション</a>
  
## イベントドリブンアプリケーション <a name="eventDrivenApps"></a>

### イベントドリブンアプリケーションとは?

イベント駆動型アプリケーションは、1 つ以上のイベントストリームからイベントを取り込み、計算、状態更新、または外部アクションをトリガーすることで、入ってくるイベントに反応するステートフルなアプリケーションです。

イベント駆動型アプリケーションは、計算層とデータストレージ層が分離させた、伝統的なアプリケーション設計を進化させたものです。従来のアーキテクチャでは、アプリケーションはリモート・トランザクション・データベースからデータを読み取ったり、データを永続化したりします。

対照的に、イベント駆動型アプリケーションは、ステートフル・ストリーム処理アプリケーションに基づいています。この設計では、データと計算が同居しているため、ローカル（メモリ内またはディスク内）のデータアクセスが発生します。フォールトトレランスは、チェックポイントをリモートの永続的なストレージに定期的に書き込むことで達成されます。下の図は、従来のアプリケーション・アーキテクチャとイベント駆動型アプリケーションの違いを示しています。

<br>
<div class="row front-graphic">
  <img src="{{ site.baseurl }}/img/usecases-eventdrivenapps.png" width="700px" />
</div>

### イベント駆動型アプリのメリットとは？

イベント駆動型アプリケーションは、リモートデータベースへの問い合わせの代わりに、ローカルでデータにアクセスし、スループットとレイテンシの両方の面で優れたパフォーマンスを実現します。リモートの永続的なストレージへの定期的なチェックポイントは、非同期かつインクリメンタルに行うことができます。そのため、チェックポイントが通常のイベント処理に与える影響は非常に小さくなります。しかし、イベント駆動型のアプリケーション設計は、ローカルデータアクセスだけでなく、より多くの利点を提供します。階層型アーキテクチャでは、複数のアプリケーションが同じデータベースを共有することが一般的です。したがって、アプリケーションの更新によるデータレイアウトの変更やサービスのスケーリングなど、データベースのあらゆる変更は調整される必要があります。各イベント駆動型アプリケーションはそれぞれのデータに責任を持つため、データ表現の変更やアプリケーションのスケーリングはより少ない調整で済みます。

### Flinkはどのようにしてイベント駆動型アプリケーションをサポートしているのですか？

イベント駆動型アプリケーションの限界は、ストリームプロセッサがどれだけ時間と状態をうまく処理できるかによって定義されます。Flinkの優れた機能の多くは、これらのコンセプトを中心にしています。Flinkは、非常に大きなデータ量（数テラバイトまで）を、1回限りの一貫性を保証しながら管理できる豊富なステートプリミティブのセットを提供しています。さらに、イベントタイムのサポート、高度にカスタマイズ可能なウィンドウロジック、`ProcessFunction`によるきめ細かな時間制御により、高度なビジネスロジックの実装を可能にします。さらに、データストリームのパターンを検出するCEP(Complex Event Processing)ライブラリを搭載しています。

しかし、イベント駆動型アプリケーションのためのFlinkの優れた機能は、セーブポイントです。セーブポイントは、互換性のあるアプリケーションの出発点として使用できる一貫した状態イメージです。セーブポイントが与えられると、アプリケーションを更新したり、スケールを適応させたり、A/Bテストのために複数のバージョンのアプリケーションを起動することができます。

### 代表的なイベント駆動型アプリケーションとは？

* <a href="https://sf-2017.flink-forward.org/kb_sessions/streaming-models-how-ing-adds-models-at-runtime-to-catch-fraudsters/">不正検知</a>
* <a href="https://sf-2017.flink-forward.org/kb_sessions/building-a-real-time-anomaly-detection-system-with-flink-mux/">異常検出</a>
* <a href="https://sf-2017.flink-forward.org/kb_sessions/dynamically-configured-stream-processing-using-flink-kafka/">ルールベースのアラート</a> 
* <a href="https://jobs.zalando.com/tech/blog/complex-event-generation-for-business-process-monitoring-using-apache-flink/">業務プロセス監視</a>
* <a href="https://berlin-2017.flink-forward.org/kb_sessions/drivetribes-kappa-architecture-with-apache-flink/">Web アプリケーション (ソーシャルネットワーク)</a>

## データ分析アプリケーション<a name="analytics"></a>

### データ分析アプリケーションとは?

分析的なジョブは、生データから情報や洞察を抽出します。従来、分析は、記録されたイベントの限られたデータセットに対するバッチクエリまたはアプリケーションとして実行されていました。最新のデータを分析結果に組み込むためには、分析したデータセットに追加し、クエリまたはアプリケーションを再実行する必要があります。結果はストレージシステムに書き込まれたり、レポートとして出力されます。

洗練されたストリーム処理エンジンを使用すると、アナリティクスもリアルタイムで実行できます。有限のデータセットを読み込む代わりに、ストリーミングクエリまたはアプリケーションはリアルタイムのイベントストリームを取り込み、イベントが消費されると継続的に結果を生成して更新します。結果は外部データベースに書き込まれるか、内部状態として維持されます。ダッシュボードアプリケーションは、外部データベースから最新の結果を読み込むか、アプリケーションの内部状態を直接問い合わせることができます。

Apache Flink は下の図のようにストリーミングだけでなく、バッチ分析アプリケーションもサポートしています。

<div class="row front-graphic">
  <img src="{{ site.baseurl }}/img/usecases-analytics.png" width="700px" />
</div>

### ストリーミング分析アプリのメリットとは？

バッチ分析と比較した連続ストリーミング分析の利点は、定期的なインポートとクエリ実行の排除により、イベントからインサイトまでの待ち時間が大幅に短縮されることだけではありません。バッチクエリとは対照的に、ストリーミングクエリは、定期的なインポートと入力の境界の性質によって引き起こされる入力データの人為的な境界に対処する必要がありません。

もう一つの側面は、よりシンプルなアプリケーションアーキテクチャです。バッチ分析パイプラインは、データの取り込みとクエリの実行を定期的にスケジュールするために、いくつかの独立したコンポーネントで構成されています。1つのコンポーネントの故障がパイプラインの次のステップに影響するため、このようなパイプラインを確実に運用することは容易ではありません。対照的に、Flinkのような洗練されたストリームプロセッサ上で実行されるストリーミング分析アプリケーションは、データの取り込みから連続的な結果計算までのすべてのステップを組み込んでいます。そのため、エンジンの障害回復メカニズムに頼ることができます。

### Flinkはどのようにデータ分析アプリケーションをサポートしていますか？

Flinkは、バッチ分析だけでなく、継続的なストリーミング分析にも非常に優れたサポートを提供します。具体的には、バッチおよびストリーミングクエリのための統一されたセマンティクスを備えたANSI準拠のSQLインターフェイスを特徴としています。SQL クエリは、記録されたイベントの静的なデータセットでも、リアルタイムのイベントストリームでも、同じ結果を計算します。ユーザー定義関数の豊富なサポートにより、カスタムコードをSQLクエリで実行することができます。さらにカスタムロジックが必要な場合は、FlinkのDataStream APIまたはDataSet APIを使用することで、より低レベルの制御が可能です。さらに、FlinkのGellyライブラリは、バッチデータセット上での大規模かつ高性能なグラフ分析のためのアルゴリズムとビルディングブロックを提供します。

### データ分析の代表的なアプリケーションとは？

* <a href="http://2016.flink-forward.org/kb_sessions/a-brief-history-of-time-with-apache-flink-real-time-monitoring-and-analysis-with-flink-kafka-hb/">通信事業者ネットワークの品質監視</a>
* <a href="https://techblog.king.com/rbea-scalable-real-time-analytics-king/">モバイルアプリケーションにおける製品アップデートの分析と実験評価</a> 
* <a href="https://eng.uber.com/athenax/">消費者技術におけるライブデータのアドホック分析</a>
* 大規模グラフ解析

## データパイプラインアプリケーション <a name="pipelines"></a>

### データパイプラインとは？

抽出-変換-ロード（ETL）は、ストレージシステム間でデータを変換して移動するための一般的なアプローチです。トランザクションデータベースシステムから分析データベースやデータウェアハウスにデータをコピーするために、ETLジョブが定期的にトリガーされることがよくあります。

データパイプラインは、ETLジョブと同様の目的で使用されます。データを変換して濃縮し、あるストレージシステムから別のストレージシステムに移動させることができます。しかし、定期的にトリガーされるのではなく、連続的なストリーミング・モードで動作します。したがって、継続的にデータを生成するソースからレコードを読み取り、低レイテンシで目的地に移動させることができます。例えば、データパイプラインはファイルシステムのディレクトリに新しいファイルがないか監視し、そのデータをイベントログに書き込むかもしれません。別のアプリケーションでは、イベント・ストリームをデータベースに具現化したり、検索インデックスをインクリメンタルに構築して洗練させたりすることができるかもしれません。

下の図は、定期的なETLジョブと連続データパイプラインの違いを示しています。

<div class="row front-graphic">
  <img src="{{ site.baseurl }}/img/usecases-datapipelines.png" width="700px" />
</div>

### データパイプラインのメリットとは？

周期的なETLジョブよりも継続的なデータパイプラインの明らかな利点は、データを目的地に移動させる際のレイテンシが減少することです。さらに、データパイプラインは継続的にデータを消費して放出することができるため、より汎用性が高く、より多くのユースケースで採用することができます。

### Flinkはどのようにデータパイプラインをサポートしていますか？

多くの一般的なデータ変換やエンリッチメントのタスクは、FlinkのSQLインターフェイス(またはテーブルAPI)とユーザー定義関数のサポートにより対応できます。より高度な要件を持つデータパイプラインは、より汎用的なDataStream APIを使用することで実現できます。Flinkは、Kafka、Kinesis、Elasticsearch、JDBCデータベースシステムなどの様々なストレージシステムへの豊富なコネクタセットを提供します。また、ディレクトリを監視するファイルシステムや、タイムバケット方式でファイルを書き込むシンクのための継続的なソースも提供しています。

### 代表的なデータパイプラインのアプリケーションとは？

* <a href="https://ververica.com/blog/blink-flink-alibaba-search">電子商取引におけるリアルタイム検索インデックス構築</a>
* <a href="https://jobs.zalando.com/tech/blog/apache-showdown-flink-vs.-spark/">電子商取引における継続的なETL</a>

